<!DOCTYPE html>
<html lang="en">
<head http-equiv="Access-Control-Allow-Origin">
    <meta charset="UTF-8">
    <title>scene edi</title>
    <script src="../vue.min.js"></script>
    <script src="../../js/libs/pixi.js"></script>
    <script src="../../js/libs/pixi-filters.js"></script>
    <script src="../../js/module/00-utils/05-entity.js"></script>
    <script src="../../js/module/00-utils/02-math.js"></script>
    <script src="../../js/module/03-scene/02-filter.js"></script>
    <link rel="stylesheet" type="text/css" href="css.css">
</head>
<body>
<div id="window">
    <div class="tool_main">
        <div  class="tool_main-item hover1" :class="src[0]!==key?'':'hover1-acti'"
              @click="F_handle(handle.src,[0,key])"  v-for="key of page">
            {{key}}
        </div>
    </div>
    <div class="fun_main">
        <div  class="fun_main-item hover1"
              @click="F_handle(handle.sys,[key])"  v-for="key of btn">
            {{key}}
        </div>
    </div>

    <div class="view_main">
        <div class="list">
            <table v-if="D_tree[0]" class="tool">
                <tr>
                    <td><input class="input"  @click="F_handle(handle.additem,[0])"  value="add" type="button"></td>
                    <td><input class="input"  @click="F_handle(handle.subitem,[0])"  value="remove" type="button"></td>
                </tr>
            </table>
            <div v-if="D_tree[0]" class="sidebar">
                <div class="sidebar-item hover2" :class="src[1]!==key?'':'hover2-acti'"
                     @click="F_handle(handle.src,[1,key])"  v-for="(val,key) of D_tree[0]">
                    <input  @input="ediId(1)"  v-model="key">
                </div>
            </div>
        </div>
        <div v-if="D_tree[1]&&src[0]==='bit'" class="box">
            <div id="img_bit" :style="{backgroundImage: 'url(../../' + D_tree[1][0] + D_tree[1][1] + '.png)',filter: 'hue-rotate(' + D_tree[1][2] + 'deg)'}">
                <div class="img-size">{{img_size[0]}}×{{img_size[1]}}</div>
            </div>
            <div id="com_bit">
                <table class="table">
                    <tr>
                        <td rowspan="2" width="300px" style="font-size: 13px">
                            <div style="height:20px">{{D_tree[1][0]}}{{D_tree[1][1]}}</div>
                            <input @change="F_bitSrc" ref="bit_file"  type="file"  class="none" accept=".png"  type="button" value="src">
                            <input @click="F_handle(handle.click,['bit_file'])"   class="input" type="button" value="src">
                        </td>
                        <td rowspan="2">smooth<input type="checkbox"  v-model="D_tree[1][3]"></td>
                        <td><input @input="$forceUpdate()" type="range" min="0" max="255" step="1" v-model="D_tree[1][2]"></td>
                        <td width="40px">{{D_tree[1][2]}}</td>
                    </tr>
                </table>
            </div>
        </div>
        <div v-if="D_tree[1]&&src[0]==='sound'" class="box">
            <table class="table">
                <tr>
                    <td style="font-size: 13px">
                        <div style="height:20px">{{D_tree[1].type}}/{{D_tree[1].name}}({{audio_time}})</div>
                        <input  @change="F_soundSrc" ref="sound_file"  class="none" accept=".ogg" type="file"  value="src">
                        <input  @click="F_handle(handle.click,['sound_file'])"  class="input" type="button" value="src">
                    </td>
                    <td><input @click="F_play" class="input" type="button" value="播放"></td>
                </tr>
                <tr>
                    <td >
                        <table width="100%">
                            <tr>
                                <td>volume</td>
                                <td><input @input="$forceUpdate()" type="range" min="0" max="2" step="0.1" v-model="D_tree[1].volume"></td>
                                <td><input class="conf" type="number"  v-model="D_tree[1].volume"></td>
                            </tr>
                            <tr>
                                <td>rate</td>
                                <td><input @input="$forceUpdate()" type="range" min="0" max="8" step="0.05" v-model="D_tree[1].rate"></td>
                                <td><input class="conf" type="number"  v-model="D_tree[1].rate"></td>
                            </tr>
                        </table>
                    </td>
                    <td>
                        <table width="100%">
                            <tr>
                                <td>pan</td>
                                <td><input class="conf" type="number"  v-model="D_tree[1].pan[0]"></td>
                                <td><input @input="$forceUpdate()" type="range" min="-1" max="1" step="0.01" v-model="D_tree[1].pan[0]"></td>
                            </tr>
                            <tr>
                                <td>panvol</td>
                                <td><input class="conf" type="number"  v-model="D_tree[1].pan[1]"></td>
                                <td><input @input="$forceUpdate()" type="range" min="-12" max="12" step="0.1" v-model="D_tree[1].pan[1]"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table width="100%">
                            <tr>
                                <td width="250px">
                                    <table width="100%">
                                        <tr>
                                            <td><label>loop</label><input type="checkbox"  v-model="D_tree[1].loop[0]"></td>
                                            <td v-if="D_tree[1].loop[0]">
                                                <input type="number"
                                                       @input="D_tree[1].loop[1]=Math.min(Number(D_tree[1].loop[1]),Number(D_tree[1].loop[2]))"
                                                       v-model="D_tree[1].loop[1]">
                                                <input type="number"
                                                       @input="D_tree[1].loop[2]=Math.min(Number(D_tree[1].loop[2]),audio_time)"
                                                       v-model="D_tree[1].loop[2]">
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td>
                                    <table width="100%">
                                        <tr>
                                            <td>start</td>
                                            <td><input class="conf" type="number"
                                                       @input="D_tree[1].time[0]=Math.min(Number(D_tree[1].time[0]),audio_time)"
                                                       v-model="D_tree[1].time[0]">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>time</td>
                                            <td>
                                                <input class="conf" type="number"
                                                       @input="D_tree[1].time[1]=Number(D_tree[1].time[1])"
                                                       v-model="D_tree[1].time[1]">
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                <td>
                                    <table width="100%">
                                        <tr>
                                            <td><label>traje</label><input class="conf" type="number" v-model="D_tree[1].traje"></td>
                                            <td><label>revers</label><input type="checkbox"  v-model="D_tree[1].revers"></td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table width="100%">
                            <tr>
                                <td>fadeIn</td>
                                <td> <select  v-model="D_tree[1].fade[2]">
                                    <option value="linear">linear</option>
                                    <option value="exponential">exponential</option>
                                    <option value="power">power</option>
                                    <option value="ease">ease</option>
                                    <option value="bounce">bounce</option>
                                </select></td>
                                <td> <input class="conf" type="number"
                                            @input="D_tree[1].fade[0]=Number(D_tree[1].fade[0])"
                                            v-model="D_tree[1].fade[0]"></td>
                            </tr>
                            <tr>
                                <td>fadeOut</td>
                                <td> <select  v-model="D_tree[1].fade[3]">
                                    <option value="linear">linear</option>
                                    <option value="exponential">exponential</option>
                                    <option value="power">power</option>
                                    <option value="ease">ease</option>
                                    <option value="bounce">bounce</option>
                                </select></td>
                                <td><input class="conf" type="number"
                                           @input="D_tree[1].fade[1]=Number(D_tree[1].fade[1])"
                                           v-model="D_tree[1].fade[1]"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table width="100%">
                            <tr>
                                <td rowspan="2">
                                    Distortion
                                </td>
                                <td>val</td>
                                <td><input @input="$forceUpdate()" type="range" min="0" max="1" step="0.01" v-model="D_tree[1].dis[0]"></td>
                                <td><input class="conf" type="number"  v-model="D_tree[1].dis[0]"></td>
                            </tr>
                            <tr>
                                <td>oversample</td>
                                <td colspan="2">
                                    <select v-model="D_tree[1].dis[1]">
                                        <option value="none">none</option>
                                        <option value="2x">2x</option>
                                        <option value="4x">4x</option>
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table width="100%">
                            <tr>
                                <td rowspan="2">
                                    BitCrusher
                                </td>
                                <td>bits</td>
                                <td><input @input="$forceUpdate()" type="range" min="1" max="16" step="1" v-model="D_tree[1].bit[0]"></td>
                                <td><input class="conf" type="number"  v-model="D_tree[1].bit[0]"></td>
                            </tr>
                            <tr>
                                <td>wet</td>
                                <td><input @input="$forceUpdate()" type="range" min="0" max="1" step="0.01" v-model="D_tree[1].bit[1]"></td>
                                <td><input class="conf" type="number"  v-model="D_tree[1].bit[1]"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table width="100%">
                            <tr>
                                <td rowspan="2">Filter</td>
                                <td rowspan="2">type</td>
                                <td rowspan="2">
                                    <select v-model="D_tree[1].filter[0]">
                                      <option value="none">none</option>
                                      <option value="lowpass">lowpass</option>
                                      <option value="highpass">highpass</option>
                                      <option value="bandpass">bandpass</option>
                                      <option value="lowshelf">lowshelf</option>
                                      <option value="highshelf">highshelf</option>
                                      <option value="notch">notch</option>
                                      <option value="allpass">allpass</option>
                                    </select>
                                </td>
                                <td>frequency</td>
                                <td><input class="conf" type="number"  v-model="D_tree[1].filter[1]"></td>
                                <td>rolloff</td>
                                <td>
                                    <select v-model="D_tree[1].filter[2]">
                                        <option value="0">0</option>
                                        <option value="-12">-12</option>
                                        <option value="-24">-24</option>
                                        <option value="-36">-36</option>
                                        <option value="-48">-48</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Q</td>
                                <td><input class="conf"  @input="$forceUpdate()"  type="number"  v-model="D_tree[1].filter[3]"></td>
                                <td>gain</td>
                                <td><input class="conf"  @input="$forceUpdate()"  type="number"  v-model="D_tree[1].filter[4]"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>
        <div v-if="D_tree[1]&&src[0]==='filter'"  class="box">
          <table class="table">
              <tr>
                  <td>
                      <table style="width: 100%">
                          <tr>
                              <td>type</td>
                              <td><select @change="F_filerUniforms"  v-model="D_tree[1].type">
                                  <option value="adj">调整</option>
                                  <option value="bloom">高级泛光</option>
                                  <option value="ascii">Ascii</option>
                                  <option value="bulge">凸起收缩</option>
                                  <option value="convo">卷积</option>
                                  <option value="colorRep">颜色替换</option>
                                  <option value="cross">交叉线</option>
                                  <option value="crt">CRT</option>
                                  <option value="dot">像素点</option>
                                  <option value="emboss">浮雕</option>
                                  <option value="glitch">故障</option>
                                  <option value="glow">发光</option>
                                  <option value="godray">光束</option>
                                  <option value="motion">运动模糊</option>
                                  <option value="old">老电影</option>
                                  <option value="outline">轮廓</option>
                                  <option value="pixel">像素化</option>
                                  <option value="kawa">模糊</option>
                                  <option value="radial">径向模糊</option>
                                  <option value="rgb">RGB分离</option>
                                  <option value="shock">冲击波</option>
                                  <option value="tiltX">倾斜X轴</option>
                                  <option value="tiltY">倾斜Y轴</option>
                                  <option value="twist">扭曲</option>
                                  <option value="zoom">缩放模糊</option>
                              </select></td>
                          </tr>
                          <tr>
                              <td>com</td>
                              <td>
                                  <select  v-model="D_tree[1].com">
                                      <option v-for="(val,key) of $data.basedata.handler"  :value="key">{{key}}</option>
                                  </select>
                              </td>
                          </tr>
                      </table>
                  </td>
                  <td>
                      <table style="width: 100%">
                          <tr><td>cycle</td><td><input  v-model="D_tree[1].cycle" type="number"></td></tr>
                          <tr><td>time</td><td><input   v-model="D_tree[1].time" type="number"></td></tr>
                      </table>
                  </td>
                  <td>
                      <table style="width: 100%">
                          <tr><td>activa</td><td><input v-model="D_tree[1].acti" type="checkbox"></td></tr>
                          <tr><td>cease</td><td><input v-model="D_tree[1].cease" type="checkbox"></td></tr>
                      </table>
                  </td>
                  <td rowspan="2">
                      <table width="100%">
                          <tr>
                              <td colspan="2" style="max-width:180px">parameter</td>
                              <td rowspan="3" style="vertical-align: top;min-width:275px">
                                  <table v-if="D_tree[3]&&D_tree[3].cor"  style="width:100%">
                                      <tr>
                                          <td colspan="2">
                                              {{src[3]}}
                                              <input  @change="exWave()"  type="checkbox"  v-model="D_tree[3].cor">
                                          </td>
                                      </tr>
                                      <tr>
                                          <td>type</td>
                                          <td>val</td>
                                      </tr>
                                      <tr>
                                          <td>
                                              <select  v-model="D_tree[3].type">
                                                  <option value="seed">seed</option>
                                                  <option value="add">add</option>
                                              </select>
                                          </td>
                                          <td><input class="conf" type="number" v-model="D_tree[3].val"></td>
                                      </tr>
                                  </table>
                                  <table v-else style="width:100%">
                                      <tr v-if="D_tree[3]">
                                          <td colspan="2">
                                              {{src[3]}}
                                              <input @change="exWave(true)"  type="checkbox">
                                          </td>
                                      </tr>
                                      <tr>
                                          <td><input class="input"  @click="F_handle(handle.additem,[3])" type="button" value="add"></td>
                                          <td><input class="input"  @click="F_handle(handle.subarr,[3])" type="button" value="remove"></td>
                                      </tr>
                                      <tr>
                                          <td colspan="2" >
                                              <table>
                                                  <tr>
                                                      <td @click="F_handle(handle.src,[4,key])" :class="src[4]!==key?'btn':'btn-hover'" v-for="(item,key) of D_tree[3]">
                                                          {{key}}
                                                      </td>
                                                  </tr>
                                              </table>
                                           
                                          </td>
                                      </tr>
                                      <tr>
                                          <td colspan="2">
                                              <table v-if="key==src[4]"  v-for="(item,key) in D_tree[3]">
                                                  <tr>
                                                      <td>count</td><td><select  v-model="item.count">
                                                              <option value="add">add</option>
                                                              <option value="mul">mul</option>
                                                              <option value="and">and</option>
                                                              <option value="or">or</option>
                                                              <option value="xor">xor</option>
                                                              <option value="max">max</option>
                                                              <option value="min">min</option>
                                                              <option value="pow">pow</option>
                                                          </select></td>
                                                      <td>wave</td><td><select v-model="item.wave">
                                                          <option value=104>方波</option>
                                                          <option value=204>三角波</option>
                                                          <option value=304>正弦波</option>
                                                          <option value=404>平滑波</option>

                                                          <option value=105>半圆波</option>
                                                          <option value=205>方根波</option>
                                                          <option value=305>E波</option>
                                                          <option value=405>弹跳波</option>
                                                          <option value=505>平方三角</option>
                                                          <option value=605>平方正弦</option>
                                                          <option value=705>斐波那契</option>

                                                          <option value=101>振荡波</option>
                                                          <option value=201>振荡余弦</option>
                                                          <option value=301>振荡正切</option>
                                                          <option value=401>平均振荡</option>

                                                          <option value=102>指数</option>
                                                          <option value=202>反比例</option>
                                                          <option value=302>弦反比例</option>
                                                          <option value=402>方根波</option>
                                                          <option value=502>平方波</option>
                                                          <option value=602>正态波</option>
                                                          <option value=702>弹性波</option>
                                                          <option value=802>贝塞尔</option>
                                                          <option value=902>阻尼</option>
                                                      </select></td>
                                                  </tr>
                                                  <tr>
                                                      <td>digit</td><td><input   type="checkbox" v-model="item.digit"></td>
                                                      <td>reve</td><td><input    type="checkbox" v-model="item.reve"></td>
                                                  </tr>
                                                  <tr>
                                                      <td>frame</td><td><input  class="conf" type="number" v-model="item.frame"></td>
                                                      <td>phase</td><td><input  class="conf" type="number" v-model="item.phase"></td>
                                                  </tr>
                                                  <tr>
                                                      <td>freq</td><td><input   class="conf"  type="number" v-model="item.freq"></td>
                                                      <td>sample</td><td><input  class="conf" type="number" v-model="item.sample"></td>
                                                  </tr>
                                                  <tr>
                                                      <td>val1</td><td><input class="conf"  type="number" v-model="item.val1"></td>
                                                      <td>val2</td><td><input class="conf"  type="number" v-model="item.val2"></td>
                                                  </tr>
                                              </table>
                                          </td>
                                      </tr>
                                  </table>
                              </td>
                          </tr>
                          <tr>
                              <td><input class="input"  @click="F_handle(handle.src,[2,'wave']);F_handle(handle.additem,[2])" type="button" value="add"></td>
                              <td><input class="input"  @click="F_handle(handle.subitem,[2])" type="button" value="remove"></td>
                          </tr>
                          <tr>
                              <td colspan="2" style="max-width:180px">
                                  <div class="parameter">
                                      <button   class="hover3" :class="src[3]!==key?'':'hover3-acti'"
                                               @click="F_handle(handle.src,[2,'wave']);F_handle(handle.src,[3,key])"  v-for="(item,key) of D_tree[1].wave">
                                          <input style="width:120px" :style="{'color':item.cor?'var(--w-color)':'var(--y-color)'}"  @input="ediId(3)"  v-model="key">
                                      </button>
                                  </div>
                              </td>
                          </tr>
                      </table>
                  </td>
              </tr>
              <tr>
                  <td colspan="3" style="vertical-align: top;max-width:300px">
                      <table width="100%">
                          <tr><td colspan="4">uniforms</td></tr>
                          <tr>
                              <td class="flex" style="height: calc(100vh - 200px);overflow:auto">
                                  <div style="font-size:12px;border:2px silver solid"  v-for="(val,key,index) of D_tree[1].uniforms">
                                      {{key}}<br>
                                      <input style="min-width:60px" class="conf" v-model="D_tree[1].uniforms[key]">
                                  </div>
                              </td>
                          </tr>
                      </table>
                  </td>
              </tr>
          </table>
        </div>
        <div v-if="D_tree[1]&&src[0]==='text'" class="box">
            {{D_tree[1]}}
        </div>
    </div>
    <div class="src_main">
        <div class="src_main-item hover1"  :class="(index===src.length-1)?'hover1-acti':''"
             @click="F_handle(handle.src,[index,key])" v-for="(key,index) of src">
            {{key}}
        </div>
    </div>
    <img id="load_bit" :src="src[0]==='bit'&&src[1]?'../../'+D_tree[1][0]+D_tree[1][1]+'.png':''" style="display: none;">
    <div v-if="json" @dblclick="json=false"  class="json">
        <textarea disabled v-model="JSON.stringify(basedata)"></textarea>
    </div>
</div>
<div id="load"></div>

<script src="js/handle.js"></script>
<script src="js/main.js"></script>
</body>
</html>